From 85d288fee6fb115b03cee544cab1636510f81553 Mon Sep 17 00:00:00 2001
From: Thomas Guillem <thomas@gllm.fr>
Date: Wed, 2 Mar 2022 11:40:00 +0100
Subject: [PATCH 53/58] contrib: libdsm: update to 0.4.0

And switch to meson.
---
 contrib/src/libdsm/SHA512SUMS |  2 +-
 contrib/src/libdsm/rules.mak  | 22 +++++++++-------------
 2 files changed, 10 insertions(+), 14 deletions(-)

diff --git a/contrib/src/libdsm/SHA512SUMS b/contrib/src/libdsm/SHA512SUMS
index 2e5c073400..3581c466be 100644
--- a/contrib/src/libdsm/SHA512SUMS
+++ b/contrib/src/libdsm/SHA512SUMS
@@ -1 +1 @@
-59963c1d12839004c7e3717cf5f029ffc5f10d72b133d88c33c1367f4343befb170c2b10f7cbc690d1700b380e298436e34b80fc214546f6ded104c649ee21eb  libdsm-0.3.2.tar.gz
+34542dbe8cfd52b0ef94ccee697b50cce359cae1c58e14289667285519a6a6579323bbfbb29297cdd2dd4ccd2b7da7c571eba3fb18d596f064a3233029efb484  libdsm-0.4.0.tar.xz
diff --git a/contrib/src/libdsm/rules.mak b/contrib/src/libdsm/rules.mak
index 87c70e2669..7ef5743c1d 100644
--- a/contrib/src/libdsm/rules.mak
+++ b/contrib/src/libdsm/rules.mak
@@ -1,14 +1,13 @@
 # libdsm
 
-#LIBDSM_GITURL := git://github.com/videolabs/libdsm.git
-LIBDSM_VERSION := 0.3.2
-LIBDSM_URL := https://github.com/videolabs/libdsm/releases/download/v$(LIBDSM_VERSION)/libdsm-$(LIBDSM_VERSION).tar.gz
+LIBDSM_VERSION := 0.4.0
+LIBDSM_URL := https://github.com/videolabs/libdsm/releases/download/v$(LIBDSM_VERSION)/libdsm-$(LIBDSM_VERSION).tar.xz
 
 ifeq ($(call need_pkg,"libdsm >= 0.2.0"),)
 PKGS_FOUND += libdsm
 endif
 
-$(TARBALLS)/libdsm-$(LIBDSM_VERSION).tar.gz:
+$(TARBALLS)/libdsm-$(LIBDSM_VERSION).tar.xz:
 	$(call download_pkg,$(LIBDSM_URL),libdsm)
 
 LIBDSM_CONF = $(HOSTCONF)
@@ -16,9 +15,9 @@ LIBDSM_CONF = $(HOSTCONF)
 ifndef WITH_OPTIMIZATION
 LIBDSM_CONF += --enable-debug
 endif
-.sum-libdsm: libdsm-$(LIBDSM_VERSION).tar.gz
+.sum-libdsm: libdsm-$(LIBDSM_VERSION).tar.xz
 
-libdsm: libdsm-$(LIBDSM_VERSION).tar.gz .sum-libdsm
+libdsm: libdsm-$(LIBDSM_VERSION).tar.xz .sum-libdsm
 	$(UNPACK)
 	$(MOVE)
 
@@ -27,11 +26,8 @@ ifdef HAVE_WIN32
 DEPS_libdsm += pthreads $(DEPS_pthreads)
 endif
 
-.libdsm: libdsm
-	cd $< && touch "config.rpath"
-	$(RECONF)
-	cd $< && $(HOSTVARS_PIC) ./configure --disable-programs $(LIBDSM_CONF)
-	cd $< && $(MAKE)
-	$(call pkg_static,"libdsm.pc")
-	cd $< && $(MAKE) install
+.libdsm: libdsm crossfile.meson
+	cd $< && rm -rf ./build
+	cd $< && $(HOSTVARS_MESON) $(MESON) -Dauto_features=disabled -Dbinaries=false build
+	cd $< && cd build && ninja install
 	touch $@
-- 
2.32.0 (Apple Git-132)

